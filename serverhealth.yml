---
- name: Get system information for Windows server
  hosts: all
  gather_facts: yes

  tasks:
    - name: Ping server
      win_ping:

    - name: Check CPU usage
      win_shell: "Get-WmiObject -Class Win32_Processor | Select-Object -ExpandProperty LoadPercentage"
      register: cpu_result

    - name: Check memory usage
      win_shell: "Get-Counter -Counter '\\Memory\\% Committed Bytes In Use' | Select-Object -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue"
      register: memory_result

    - name: Check uptime
      win_shell: "Get-CimInstance -ClassName Win32_OperatingSystem | Select-Object -ExpandProperty LastBootUpTime"
      register: uptime_result

    - name: Display results
      debug:
        msg: |
          CPU usage:
          {{ cpu_result }}
          Memory usage:
          {{ memory_result }}
          Uptime:
          {{ uptime_result }}
