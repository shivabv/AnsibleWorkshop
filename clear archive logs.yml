- name: Delete archive files in Windows folder
  hosts: all
  gather_facts: no
  tasks:
    - name: Find a files
      win_find:
        paths: 'C:\temp'
        file_type: directory
        hidden: yes
        recurse: yes
        patterns: '*archive*'
      register: archive_files
      vars:
        ansible_become: yes
        ansible_become_method: runas
        ansible_become_user: training
        ansible_become_password: Training1!
        ansible_become_flags: logon_type=new_credentials logon_flags=netcredentials_only
     
    - name: Delete archive files
      win_file:
        path: "{{ item.path }}"
        state: absent
      loop: "{{ archive_files.files }}"
